{% extends "layout.html" %}

{% block content %}
<div class="center-panel">
    <!-- Back Button -->
    <a href="{{ url_for('index') }}" style="display:inline-flex;align-items:center;gap:8px;margin-bottom:20px;color:var(--primary);text-decoration:none;font-weight:600;transition:0.2s" onmouseover="this.style.opacity=0.8" onmouseout="this.style.opacity=1">
        <i class="fas fa-arrow-left"></i> Back to Home
    </a>

    <!-- Header -->
    <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px">
        <img src="{{ avatar_url(user,80) }}" alt="avatar" style="width:80px;height:80px;border-radius:12px;object-fit:cover;border:3px solid var(--primary)">
        <div>
            <h2 style="margin:0;color:var(--text);font-size:22px">{{ user.username|display_name }}'s Followers</h2>
            <p style="margin:6px 0 0 0;color:var(--muted);font-size:14px">{{ followers.total }} followers</p>
        </div>
    </div>

    <!-- Followers Grid -->
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px">
        {% if followers.items %}
            {% for follower in followers.items %}
                <div class="sidebar-card" style="display:flex;flex-direction:column;padding:20px">
                    <div style="display:flex;gap:12px;align-items:flex-start;margin-bottom:16px">
                        <img src="{{ avatar_url(follower,48) }}" alt="avatar" style="width:48px;height:48px;border-radius:8px;object-fit:cover">
                        <div style="flex:1">
                            <div style="font-weight:700;color:var(--text)">{{ follower.username|display_name }}</div>
                            <div style="color:var(--muted);font-size:12px">{{ follower.posts|length }} posts</div>
                        </div>
                    </div>
                    
                    <div style="display:flex;gap:8px">
                        <a href="{{ url_for('view_followers', user_id=follower.id) }}" style="flex:1;padding:8px;background:rgba(0,212,255,0.1);border:1px solid rgba(0,212,255,0.2);border-radius:6px;text-align:center;color:var(--primary);text-decoration:none;font-size:12px;font-weight:600;transition:0.2s" onmouseover="this.style.background='rgba(0,212,255,0.15)'" onmouseout="this.style.background='rgba(0,212,255,0.1)'">
                            View Profile
                        </a>
                        
                        {% if is_own_profile %}
                            <button onclick="removeFollower(this, {{ follower.id }})" style="padding:8px 12px;background:rgba(255,107,53,0.1);border:1px solid rgba(255,107,53,0.2);border-radius:6px;color:var(--accent-warm);text-decoration:none;font-size:12px;font-weight:600;cursor:pointer;transition:0.2s" onmouseover="this.style.background='rgba(255,107,53,0.15)'" onmouseout="this.style.background='rgba(255,107,53,0.1)'">
                                <i class="fas fa-times"></i>
                            </button>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div style="grid-column:1/-1;padding:40px;text-align:center;color:var(--muted)">
                <i class="fas fa-user-slash" style="font-size:48px;opacity:0.3;display:block;margin-bottom:12px"></i>
                <p>No followers yet</p>
            </div>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if followers.pages and followers.pages > 1 %}
        <div style="display:flex;gap:8px;justify-content:center;margin-top:28px">
            {% if followers.has_prev %}
                <a href="{{ url_for('view_followers', user_id=user.id, page=followers.prev_num) }}" class="btn-primary" style="width:auto;padding:8px 10px">Prev</a>
            {% endif %}

            {% for p in range(1, followers.pages + 1) %}
                {% if p == followers.page %}
                    <span style="padding:8px 10px;border-radius:8px;background:var(--primary);color:#fff;font-weight:600">{{ p }}</span>
                {% else %}
                    <a href="{{ url_for('view_followers', user_id=user.id, page=p) }}" style="padding:8px 10px;border-radius:8px;background:transparent;color:var(--text);border:1px solid rgba(2,6,23,0.04);text-decoration:none">{{ p }}</a>
                {% endif %}
            {% endfor %}

            {% if followers.has_next %}
                <a href="{{ url_for('view_followers', user_id=user.id, page=followers.next_num) }}" class="btn-primary" style="width:auto;padding:8px 10px">Next</a>
            {% endif %}
        </div>
    {% endif %}
</div>

<script>
function removeFollower(button, followerId) {
    if (!confirm('Remove this follower?')) return;
    
    fetch(`/remove_follower/${followerId}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                button.closest('.sidebar-card').style.opacity = '0.5';
                setTimeout(() => button.closest('.sidebar-card').remove(), 300);
            }
        })
        .catch(err => console.error('Error:', err));
}
</script>
{% endblock %}
