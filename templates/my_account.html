{% extends "layout.html" %}
{% block content %}
<div class="account-header">
    <h2>My Account</h2>
    <p>Welcome back, {{ current_user.username|display_name }}!</p>
</div>

<!-- Profile Section -->
<div style="display:flex;align-items:flex-start;gap:16px;margin-bottom:24px;background:linear-gradient(135deg,rgba(0,212,255,0.08),rgba(255,107,53,0.04));padding:20px;border-radius:12px;border:1px solid rgba(0,212,255,0.1)">
    <img src="{{ avatar_url(current_user,96) }}" alt="avatar" style="width:96px;height:96px;border-radius:12px;object-fit:cover;border:3px solid var(--primary);flex-shrink:0">
    <form method="post" enctype="multipart/form-data" style="flex:1;display:flex;flex-direction:column;gap:12px">
        <div>
            <h3 style="margin:0;color:var(--text);font-size:20px">{{ current_user.username|display_name }}</h3>
            <p style="margin:4px 0 0 0;color:var(--muted);font-size:12px">Joined {{ current_user.created_at.strftime('%B %d, %Y') }}</p>
        </div>
        <div style="display:flex;gap:20px;font-weight:600;color:var(--text);font-size:13px">
            <span style="display:flex;align-items:center;gap:8px">
                <i class="fas fa-file-alt" style="color:var(--primary)"></i>
                {{ posts|length }} Posts
            </span>
            <a href="{{ url_for('followers') }}" style="display:flex;align-items:center;gap:8px;text-decoration:none;color:var(--text);cursor:pointer;transition:0.2s">
                <i class="fas fa-users" style="color:var(--accent-warm)"></i>
                {{ current_user.followers.count() }} Followers
            </a>
            <a href="{{ url_for('following') }}" style="display:flex;align-items:center;gap:8px;text-decoration:none;color:var(--text);cursor:pointer;transition:0.2s">
                <i class="fas fa-user-friends" style="color:var(--primary)"></i>
                {{ current_user.following_users.count() }} Following
            </a>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <label style="font-size:12px;color:var(--muted);font-weight:600">Bio (max 500 characters)</label>
            <textarea name="bio" placeholder="Tell us about yourself..." style="width:100%;height:60px;padding:10px;border:1px solid rgba(0,212,255,0.2);border-radius:8px;background:rgba(255,255,255,0.05);color:var(--text);font-size:13px;resize:vertical;font-family:inherit">{{ current_user.bio or '' }}</textarea>
        </div>
        <div style="display:flex;gap:8px;align-items:flex-end">
            <div style="flex:1">
                <label style="font-size:12px;color:var(--muted);font-weight:600;display:block;margin-bottom:6px">Change Avatar</label>
                <input type="file" name="avatar" accept="image/*" style="font-size:12px">
            </div>
            <button type="submit" class="btn-primary" style="width:auto;padding:10px 16px">Save Changes</button>
        </div>
    </form>
</div>

<!-- Quick Links -->
<div style="display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap">
    <a href="{{ url_for('bookmarks') }}" style="padding:10px 16px;background:rgba(255,107,53,0.1);color:var(--accent-warm);border:1px solid rgba(255,107,53,0.2);border-radius:8px;text-decoration:none;font-weight:600;font-size:13px;display:flex;align-items:center;gap:6px">
        <i class="fas fa-bookmark"></i> My Bookmarks
    </a>
    <a href="{{ url_for('trending') }}" style="padding:10px 16px;background:rgba(0,212,255,0.1);color:var(--primary);border:1px solid rgba(0,212,255,0.2);border-radius:8px;text-decoration:none;font-weight:600;font-size:13px;display:flex;align-items:center;gap:6px">
        <i class="fas fa-fire"></i> Trending Posts
    </a>
</div>

<h2 style="margin:24px 0 16px 0;color:var(--text)">My Posts ({{ posts|length }})</h2>
<div class="post-grid">
    {% if posts %}
        {% for post in posts %}
        <div class="post-card">
            {% if post.image_filename %}
                <img src="{{ url_for('static', filename='uploads/' ~ post.image_filename) }}" class="post-img" alt="post image">
            {% elif post.image_data %}
                <img src="data:image/*;base64,{{ post.image_data }}" class="post-img" alt="post image">
            {% else %}
                <div class="post-img" style="background:rgba(0,212,255,0.1);display:flex;align-items:center;justify-content:center;color:var(--muted)">
                    <i class="fas fa-image" style="font-size:48px"></i>
                </div>
            {% endif %}
            <h3>{{ post.title }}</h3>
            <p style="color:var(--muted);font-size:13px;margin:8px 0">{{ post.content[:100] }}...</p>
            <div style="font-size:12px;color:var(--muted);margin-bottom:12px">
                {% if post.published_at %}
                    Published: {{ post.published_at.strftime('%b %d, %Y') }}
                {% else %}
                    Draft - Not Published
                {% endif %}
            </div>
            <div class="post-actions" style="display:flex;gap:8px">
                <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn-primary" style="width:auto;padding:8px 12px;border-radius:8px;background:var(--primary);text-decoration:none;color:white;font-size:13px;display:inline-flex;align-items:center;gap:6px">
                    <i class="fas fa-edit"></i> Edit
                </a>
                <form method="post" action="{{ url_for('delete_post', post_id=post.id) }}" style="display:inline;margin:0" onsubmit="return confirm('Are you sure you want to delete this post?');">
                    <button type="submit" class="btn-primary" style="width:auto;padding:8px 12px;border-radius:8px;background:#ff6b6b;border:none;color:white;font-size:13px;cursor:pointer;display:inline-flex;align-items:center;gap:6px">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div style="padding:40px;text-align:center;color:var(--muted)">
            <i class="fas fa-pencil-alt" style="font-size:48px;opacity:0.3;display:block;margin-bottom:12px"></i>
            <p>You haven't published any posts yet.</p>
            <a href="{{ url_for('create_post') }}" style="color:var(--primary);text-decoration:none">Create your first post</a>
        </div>
    {% endif %}
</div>
{% endblock %}