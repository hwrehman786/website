{% extends "layout.html" %}

{% block content %}
<div class="center-panel">
    <!-- Profile Header -->
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:28px;background:linear-gradient(135deg,rgba(0,212,255,0.08),rgba(255,107,53,0.04));padding:24px;border-radius:14px;border:1px solid rgba(0,212,255,0.1)">
        <img src="{{ avatar_url(user,128) }}" alt="avatar" style="width:100px;height:100px;border-radius:12px;object-fit:cover;border:3px solid var(--primary)">
        <div style="flex:1">
            <h1 style="margin:0;color:var(--text);font-size:28px">{{ user.username|display_name }}</h1>
            <p style="margin:8px 0 0 0;color:var(--muted);font-size:14px">Joined {{ user.created_at.strftime('%B %d, %Y') }}</p>
            {% if user.bio %}
                <p style="margin:8px 0 0 0;color:var(--text);font-size:14px">{{ user.bio }}</p>
            {% endif %}
            <div style="display:flex;gap:20px;margin-top:12px;font-weight:600;color:var(--text);font-size:13px">
                <span><i class="fas fa-file-alt" style="color:var(--primary)"></i> {{ posts.total }} Posts</span>
                <span><i class="fas fa-users" style="color:var(--accent-warm)"></i> {{ user.followers.count() }} Followers</span>
                <span><i class="fas fa-user-friends" style="color:var(--primary)"></i> {{ user.following_users.count() }} Following</span>
            </div>
        </div>
        {% if current_user.is_authenticated and user.id != current_user.id %}
            <button class="btn-follow" onclick="toggleFollow(this, {{ user.id }})" {% if is_following %}style="border-color:var(--primary)"{% endif %}>
                <i class="fas fa-{% if is_following %}check{% else %}user-plus{% endif %}"></i>
                <span>{% if is_following %}Following{% else %}Follow{% endif %}</span>
            </button>
        {% endif %}
    </div>

    <h2 style="color:var(--text);margin:24px 0 16px 0">Posts by {{ user.username|display_name }}</h2>

    <!-- Posts Feed -->
    <div class="posts-section">
        {% if posts and posts.items %}
            {% for post in posts.items %}
                <article class="blog-post">
                    <div class="post-header">
                        <div style="display:flex;gap:12px;align-items:center">
                            <img src="{{ avatar_url(post.author,40) }}" style="width:40px;height:40px;border-radius:8px;object-fit:cover" alt="avatar">
                            <div>
                                <div style="font-weight:700;color:var(--text)">{{ post.author.username|display_name }}</div>
                                <div style="color:var(--muted);font-size:12px">{{ post.published_at.strftime('%b %d, %Y') if post.published_at else '' }}</div>
                            </div>
                        </div>
                    </div>

                    <h3 style="margin:16px 0 10px 0;color:var(--text);font-size:20px;line-height:1.4">{{ post.title }}</h3>
                    
                    <!-- Post Metadata -->
                    <div class="post-meta">
                        <div class="meta-item">
                            <i class="fas fa-clock meta-icon"></i>
                            <span>{{ (post.content|length / 200)|int }} min read</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-eye meta-icon"></i>
                            <span>{{ post.views|length }} views</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-heart meta-icon"></i>
                            <span>{{ post.likes|length }} likes</span>
                        </div>
                    </div>
                    
                    {% if post.image_filename or post.image_data %}
                        <div class="post-image">
                            {% if post.image_filename %}
                                <img src="{{ url_for('static', filename='uploads/' ~ post.image_filename) }}" alt="post image">
                            {% elif post.image_data %}
                                <img src="data:image/*;base64,{{ post.image_data }}" alt="post image">
                            {% endif %}
                        </div>
                    {% endif %}

                    <div class="post-content">{{ post.content[:300] }}...</div>

                    {% if post.tags %}
                        <div style="margin-top:16px;display:flex;flex-wrap:wrap;gap:8px">
                            {% for t in post.tags.split(',') %}
                                <a href="{{ url_for('posts_by_tag', tag=t.strip()) }}" class="tag-badge">{{ t.strip() }}</a>
                            {% endfor %}
                        </div>
                    {% endif %}
                </article>
            {% endfor %}
        {% else %}
            <div style="padding:40px;text-align:center;color:var(--muted)">
                <i class="fas fa-feather" style="font-size:48px;opacity:0.3;display:block;margin-bottom:12px"></i>
                <p>No posts yet from {{ user.username|display_name }}</p>
            </div>
        {% endif %}
    </div>

    {% if posts and posts.pages and posts.pages > 1 %}
        <div style="display:flex;gap:8px;justify-content:center;margin-top:18px">
            {% if posts.has_prev %}
                <a href="{{ url_for('user_profile', username=user.username, page=posts.prev_num) }}" class="btn-primary" style="width:auto;padding:8px 10px">Prev</a>
            {% endif %}

            {% for p in range(1, posts.pages + 1) %}
                {% if p == posts.page %}
                    <span style="padding:8px 10px;border-radius:8px;background:var(--primary);color:#fff;font-weight:600">{{ p }}</span>
                {% else %}
                    <a href="{{ url_for('user_profile', username=user.username, page=p) }}" style="padding:8px 10px;border-radius:8px;background:transparent;color:var(--text);border:1px solid rgba(2,6,23,0.04);text-decoration:none">{{ p }}</a>
                {% endif %}
            {% endfor %}

            {% if posts.has_next %}
                <a href="{{ url_for('user_profile', username=user.username, page=posts.next_num) }}" class="btn-primary" style="width:auto;padding:8px 10px">Next</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
